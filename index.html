<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>AR – Esteira Industrial</title>

    <!-- AFRAME -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- ARJS estável -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <!-- Gesture Handler -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/src/components/gesture-detector.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/src/components/gesture-handler.js"></script>

    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>

  <body>
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="antialias: true; alpha: true"
      arjs="sourceType: webcam; debugUIEnabled: false;"
      gesture-detector
    >

      <!-- MARCADOR HIRO -->
      <a-marker id="hiroMarker" preset="hiro"></a-marker>

      <!-- MODELO FORA DO MARCADOR (AGORA PODE MOVER) -->
      <a-entity id="modelContainer" gesture-handler>

        <!-- Esteira -->
        <a-gltf-model 
          id="esteira"
          src="esteira.glb"
          position="0 0 0"
          rotation="-90 0 0"
          scale="3.4 3.4 3.4"
          animation-mixer
        ></a-gltf-model>

        <!-- Painel -->
        <a-plane 
          id="painel"
          position="0 -0.7 0"
          rotation="-90 0 0"
          width="0.7"
          height="0.30"
          color="#111"
          opacity="0.85"
        ></a-plane>

        <!-- Luz -->
        <a-circle 
          id="statusLight"
          position="-0.22 -0.7 0.01"
          radius="0.06"
          color="red"
        ></a-circle>

        <!-- Texto -->
        <a-text 
          id="statusText"
          value="Aquecida"
          align="center"
          position="0 -0.63 0.01"
          scale="0.4 0.4 0.4"
          color="white"
        ></a-text>

      </a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Estado inicial
      let quente = true;

      const luz = document.querySelector("#statusLight");
      const texto = document.querySelector("#statusText");
      const marker = document.querySelector("#hiroMarker");
      const container = document.querySelector("#modelContainer");

      // Alternar estado no clique
      window.addEventListener("click", () => {
        quente = !quente;

        if (quente) {
          luz.setAttribute("color", "red");
          texto.setAttribute("value", "Aquecendo");
        } else {
          luz.setAttribute("color", "green");
          texto.setAttribute("value", "Normal");
        }
      });

      // quando o marcador é detectado → faz o modelo seguir ele
      marker.addEventListener("markerFound", () => {
        container.object3D.visible = true;
      });

      marker.addEventListener("markerLost", () => {
        container.object3D.visible = false;
      });

      // Update a cada frame: modelo segue o marcador
      AFRAME.registerComponent("follow-marker", {
        tick: function () {
          if (marker.object3D.visible) {
            container.object3D.position.copy(marker.object3D.position);
            container.object3D.rotation.copy(marker.object3D.rotation);
          }
        }
      });

      document.querySelector("a-scene").setAttribute("follow-marker", "");
    </script>

  </body>
</html>
